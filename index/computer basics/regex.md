---
tags:
  - 计算机基础/regex
  - perl
date updated: 2024-07-09 11:13
---

## 占有字符和零宽度

正则表达式匹配过程中，如果子表达式匹配到东西，而并非一个位置，并保存到匹配结果中，这样的就称为占有字符，而只匹配到一个位置，或者匹配的内容并不保存到最终匹配结果中，这样的就称为零宽度（锚点）。占有字符是互斥的，而零宽度不是互斥的。

## 控制权和位置传动

正则表达式从左到右依次进行匹配，通常情况下有一个表达式取得控制权，从字符串的摸个位置开始匹配，一个表达式开始匹配的位置是由前一个子表达匹配成功的结束位置开始的。如果表达式是零宽度，那后一个表达式的匹配位置就是零宽度匹配的位置。

# java

## 分组

指定组名

```perl
(?<name1>\d+)(?<name2>\w+)
```

用来匹配组，但是不会将匹配结果保存

```perl
(?:\d+)
```

使用小括号包含的子表达式，可以使用回溯引用`\n`,`\k<name>`来引用某个子表达式。表示与前面完全匹配的字符串

```javascript
<(h[1-6])>\w*?<\/\1>
<(?<name>h[1-6])>\w*?<\/\k<name>>
```

匹配结果: `<h1>xxx</h1>`

## 匹配标记

- `i`: 忽略大小写
- `d`: 启用 UNIX 行终止符模式
- `m`: 多行模式
- `s`: 单行模式
- `u`: 使用 Unicode 字符属性
- `U`:  使用Unicode 版本_预定义字符类_和_POSIX 字符类_.
- `x`: 启用扩展语法模式

```shell
# 打开，对后面的行有影响
(?idmsuxU)
#  关闭，对后面的行有影响
(?-idmsuxU)

# 打开，仅作用于括号内，对后面的行无影响
(?idmsuxU:X)
# 关闭，仅作用于括号内，对后面的行无影响
(?-idmsuxU:X)
```

示例

| 语法             | 高亮匹配的字符，不表示满足正则 |
| -------------- | --------------- |
| `a+`           | ==aaa==AAA      |
| `(?i)a+`       | ==aaaAAA==      |
| `a+(?i)`       | ==aaa==AAA      |
| `(?i)a+(?-i)a` | ==aaa==AAA      |
| `(?i)a+(?-i)a` | ==aaaAA==a      |

## 惰性匹配

尽可能多的匹配

```shell
X?
X*
X+
X{n}
X{n,}
X{n,m}
```

尽可能少的匹配

```shell
X??
X*?
X+?
X{n}?
X{n,}?
X{n,m}?
```

尽可能多的匹配，但不回朔，不建议使用，容易引起问题

```shell
X?+
X*+
X++
X{n}+
X{n,}+
X{n,m}+
```

例如有个字符 `aaaaa`

```shell
# 无法匹配
a++a
# 可以匹配
a+a
```

## 零宽度断言

零宽断言用于查找某些内容之前或之后的东西，仅仅用于指定一个位置，不参与内容匹配，类似`^`和`$`

| 语法         | 解释                          | 示例         | 效果                   |
| ---------- | --------------------------- | ---------- | -------------------- |
| `(?=exp)`  | 断言当前位置后面能匹配表达式 exp          | ab(?=123)  | ==ab==123ab234       |
| `(?!exp)`  | 断言当前位置后面 **_不_** 能匹配表达式 exp | ab(?!123)  | ab123==ab==234       |
| `(?<=exp)` | 断言当前位置前面能匹配表达式 exp          | (?<=123)ab | ab123==ab==234       |
| `(?<!exp)` | 断言当前位置前面 **_不_** 能匹配表达式 exp | (?<!123)ab | ==ab==123ab234==ab== |

## 结束匹配位

`\G` 表示上个匹配的结束位置

```java
"123456789".split("(?<=\\G.{4})")

// 1234 5678 9
```

## java匹配换行符

java 正则匹配时，行尾占有字符`$`是不包括换行符`\n`的，java8 支持使用`\R`来表示换行

```java
string = string.replaceAll("\\R", " --linebreak-- ");
```

## 转义

```shell
# 匹配数字或-，在中括号中-表示范围，如果匹配-，需要转义

[0-9\-]
```

## 示例

### 脱敏

```java
// 兼容数字结尾或开头, 6~8位数字直接替换位*，9~19位数字仅保留后6位
msg.replace("(?<=\\D|^)\\d{6,8}(?=\\D|$)|(?<=\\D|^)\\d{3,13}(?=\\d{6}(\\D|$))","****");
```

```java
// 不包含换行符
str.match("[^\\r\\n]+")
```


```java
// 1  或 2  或 12
str.match("^(?!$)(1)?|(2)?$")
```
# shell匹配字符串

```shell
a='I am a simple string with digits 1234'
pat='(.*) ([0-9]+)'
[[ "$a" =~ $pat ]]
echo "${BASH_REMATCH[0]}"
echo "${BASH_REMATCH[1]}"
echo "${BASH_REMATCH[2]}"
```

> I am a simple string with digits 1234 \
> I am a simple string with digits \
> 1234

## 参考文档

[[Pattern.pdf]]

[regex101](https://regex101.com/)
