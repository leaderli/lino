---
tags:
  - linux/commands/sed
date updated: 2024-03-05 18:51
---

sed 命令是利用脚本来处理文本文件。sed 可依照脚本的指令来处理、编辑文本文件。
语法

```shell
sed [-hnV][-e<script>][-f<script 文件>][文本文件]
```

## 参数说明

- -e 指定脚本的表达式，不会修改源文件，仅将修改后的内容输出到控制台
- -f 指定脚本的文件
- -i 指定脚本的表示式，会直接修改源文件
- -n 仅显示脚本所包含模板的行

## 脚本的指令支持

- a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)～

- c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！

- d ：删除，因为是删除啊，所以 d 后面通常不接任何东西；

- i ：插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；

- p ：打印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行～

  ```shell
  sed -n '1p' file # 输出第一行
  ```

- q 执行完后退出

  ```shell
  sed -n '1p;1q' file # 输出第一行，第一行后退出
  ```

- s ：取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正规表示法！例如 1,20s/old/new/g 就是啦！

- g ： 在行内进行全局替换

- w 将所选的行写入文件

- ! 对所选行以外的行执行

- l 列出非打印字符

脚本的指令可以在指定行范围内执行，例如

```shell
# 第四行行尾  新行+newline
sed -e  4a\newline testfile
# 第一到第四行行尾  新行+newline
sed -e  1，4a\newline testfile
# 最后一行 新行+newline
sed -e  $a\newline testfile


# 使用shell变量
var=hello
sed -e  '1a'${var} testfile
```

## 模糊匹配

与 grep 一样，sed 也支持特殊元字符，来进行模式查找、替换。不同的是，sed 使用的正则表达式是括在斜杠线"/"之间的模式。
如果要把正则表达式分隔符"/"改为另一个字符，比如 o，只要在这个字符前加一个反斜线，在字符后跟上正则表达式，再跟上这个字符即可。例如：sed -n '\o^Myop' datafile
sed 的正则表达式语法支持功能比较少

| 元字符      | 功能                                                   |
| :------- | :--------------------------------------------------- |
| `^`      | 行首定位符                                                |
| `$`      | 行尾定位符                                                |
| `.`      | 匹配除换行符以外的单个字符                                        |
| ` *  `   | 匹配零个或多个前导字符                                          |
| `[ ]`    | 匹配指定字符组内的任一字符                                        |
| `[^]`    | 匹配不在指定字符组内的任一字符                                      |
| `&`      | 保存查找串以便在替换串中引用 `s/my/&/` 符号`&`代表查找串。my 将被替换为`**my**` |
| `<`      | 词首定位符 `/<my/` 匹配包含以 my 开头的单词的行                       |
| `>`      | 词尾定位符 `/my>/` 匹配包含以 my 结尾的单词的行                       |
| `x{m}`   | 连续 m 个 x ，`{`需要转义 `\{`                               |
| `x{m,}`  | 至少 m 个 x                                             |
| `x{m,n}` | 至少 m 个，但不超过 n 个 x                                    |

特殊字符

- `\` 新行

## 示例

```shell
# nl 输出行号 搜索包含root的行并打印
nl  testfile|sed -n '/root/p'
# nl 输出行号 搜索包含root的行并删除
nl  testfile|sed -n '/root/d'
# nl 输出行号 搜索包含root的行并删除
# 使用正则替换
sed 's/pattern/replace/g'

# 替换为匹配组的内容
sed "s/.*'\([^']\+\)'.*/\1/"

# 对每一行执行替换为匹配组的内容
sed -n "s/.*'\([^']\+\)'.*/\1/p"
```

### 合并上下行

```shell

$ cat file.txt
1
a
2
b
3
c

$ sed 'N;s/\n/ /' file.txt

1 a
2 b
3 c
```

### 显示脚本的短名

```shell
$  sed "s/.*[/[:space:]]\([^/[:space:]]*\).sh.*/\1/g" <<< 'sh /aa/fuck1.sh -a '
fuck1
```

### 替换分割符为0x0f

```shell
# \t是tab符号，mysql查询的默认分割符
sed -i 's/\t/'$'\x0f''/g' 1.dat

# 直接替换管道的输出
cat 1.txt|sed -i 's/\t/'$'\x0f''/g'
```
